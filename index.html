<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Notestrator</title>
    <script>
      const { ipcRenderer } = require("electron");
    </script>
  </head>
  <body>
    <svg
      style="
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
      "
      data-current-color="black"
      data-current-stroke-width="3"
      data-current-tool="pen"
    ></svg>
    <script>
      const drawing = document.currentScript.previousElementSibling;
      let currentLine = null;
      window.addEventListener("mousedown", (event) => {
        drawing.insertAdjacentHTML(
          "beforeend",
          `
            <polyline
              points="${event.x} ${event.y}"
              fill="none"
              stroke="${drawing.dataset.currentColor}"
              stroke-width="${
                drawing.dataset.currentStrokeWidth *
                (drawing.dataset.currentTool === "marker" ? 3 : 1)
              }"
              stroke-opacity="${
                drawing.dataset.currentTool === "marker" ? 0.5 : 1
              }"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          `
        );
        currentLine = drawing.lastElementChild;
      });

      window.addEventListener("mousemove", (event) => {
        if (currentLine === null) return;
        currentLine.setAttribute(
          "points",
          `${currentLine.getAttribute("points")}, ${event.x} ${event.y}`
        );
      });

      window.addEventListener("mouseup", () => {
        currentLine = null;
      });

      ipcRenderer.on("color", (_, color) => {
        drawing.dataset.currentColor = color;
      });

      ipcRenderer.on("strokeWidth", (_, strokeWidth) => {
        drawing.dataset.currentStrokeWidth = strokeWidth;
      });

      ipcRenderer.on("tool", (_, tool) => {
        drawing.dataset.currentTool = tool;
      });
    </script>
  </body>
</html>
